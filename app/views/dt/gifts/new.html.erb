<%- content_for :head do -%>
  <%= javascript_include_tag "dt/ecards" %>
  <%= stylesheet_link_tag "dt/cart" %>
<%- end -%>
<%- content_for :html_title do -%>Gift It!<%- end -%>
<%- content_for :page_title do -%>Experience a new way to give.<%- end -%>
<%- content_for :nav do -%><%= dt_account_nav %><%- end -%>
<%- content_for :head do -%><%= stylesheet_link_tag 'dt/cart' %><%- end -%>

<%= render :partial => 'dt/accounts/inactive' if logged_in? && !current_user.activated? %>

<%= error_messages_for :gift %>

<% form_for(:gift, :url => dt_gifts_path, :html => {:id => "giftform", :name => "giftform"}) do |f| %>

<div class="userform">
  <h2>Your Gift Information</h2>
  <%= render :partial => 'dt/shared/form_requirednote', :locals => { :style => 'margin-bottom:0px;' } %>

  <fieldset>
    <legend>Choose a Gift Type</legend>
    <ol class="clearfix">
      <li>
        <label class="left"><strong>Thanks for giving a gift using ChristmasFuture. You've chosen to:</strong></label>
        <% if @gift.project_id? && @gift.project %><label class="left"><%= f.radio_button "project_id", ( @gift.project_id || 0 ) %> Give <%= link_to(@gift.project.name, dt_project_path(@gift.project)) %> as a gift</label><% end %>
        <label class="left"><%= f.radio_button "project_id", nil %> Give a gift card (let the recipient a choose a project)</label>
        <% unless @gift.project_id? && @gift.project %><label class="left"><%= f.radio_button "project_id", ( @gift.project_id || 0 ) %> Give a project as a gift &nbsp; &#8250; <%= link_to("choose a project", dt_projects_path) %></label><% end %>
        <%= hidden_field_tag("project_id", @gift.project_id) if @gift.project_id %>
      </li>
    </ol>
  </fieldset>

  <fieldset>
    <legend>Enter Your Information</legend>
    <div class="notes clearfix">
      <h5>Your Information</h5>
      <p>Your info, as you would like it to appear on the ecard (eg. Mom).</p>
    </div>
    <ol>
      <li><label for="gift_name">Name</label> <%= f.text_field :name %></li>
      <li><label for="gift_email"><em>*</em> Email</label> <%= f.text_field :email %></li>
      <li><label for="gift_email_confirmation"><em>*</em>Retype Email</label> <%= f.text_field :email_confirmation, :value => (logged_in? && @gift.email? ? @gift.email : nil) %></li>
    </ol>
  </fieldset>
  
  <fieldset>
    <legend>1. Recipient Information</legend>
    <div id="individual">
      <p>Do you have a <strong>lot</strong> of similar gifts to give? <%= link_to "Give more than one gift at once", "javascript:void(0);", :onclick => "$('individual').toggle();$('bulk').toggle();" %>.</p>
      <div class="notes clearfix">
        <h5>Recipient Information</h5>
        <p>His/her name, as you would like it to appear on the ecard.</p>
      </div>
      <ol>
        <li><label for="gift_to_name">Name</label> <%= f.text_field :to_name %></li>
        <li><label for="gift_to_email"><em>*</em> Email</label> <%= f.text_field :to_email %></li>
        <li><label for="gift_to_email_confirmation"><em>*</em>Retype Email</label> <%= f.text_field :to_email_confirmation %></li>
      </ol>
    </div>
    <div id="bulk" style="display:none;">
      <p><%= link_to "Return to Individual Gift Giving", "javascript:void(0);", :onclick => "$('individual').toggle();$('bulk').toggle();$('recipients').value='';" %></p>
      
      <%= render :partial => "bulk_gifts", :locals => {:f => f} %>
    </div>
  </fieldset>

  <fieldset>
    <legend>2. Gift Details</legend>
    <ol class="clearfix">
      <li>
        <label for="gift_amount">Gift Amount</label> $<%= f.text_field :amount %>
        <div class="note" style="padding-left:.5em;">Example: $100</div>
      </li>
      <li>
        <div class="columns">
          <div class="left" style="width:150px;">
            <label class="left">Ecard Image:</label>
            <div id="medImgWrap">
              <div class="medImg"><%= image_tag url_for_file_column(@ecards[0], "medium"), :id => 'mediumEcard', :alt => '' %></div>
              <div style="color:#333;"><em>Selected Image</em></div>
            </div>
            <%= f.hidden_field 'e_card_id', :id => "e_card_id" %>
          </div>
          <div class="right" style="width:300px;">
            <label for="gift_message" class="left">Your personal message to the recipient(s):</label>
            <%= f.text_area :message, :rows => 6, :cols => 35 %>
          </div>
        </div>
      </li>
      <li>
        <div id="ecardPreview" style="display:none;" class="clearfix">
          <%= hidden_field_tag "gift[preview]", 1, :id => "gift_preview" %>
          <%= button_to_function "<span>Preview your ecard &raquo;</span>", "window.open('#{preview_dt_gifts_path}?' + Form.serialize($('giftform')), 'preview', 'width=800,height=440,resizable=1,scrollbars=1')", :class => "buttonsubmit" %>
        </div>
      </li>
      <li>
        <div>Please select an image from the Ecard Gallery:</div>
        <%= render "dt/ecards/content" %>
      </li>
    </ol>
  </fieldset>

  <fieldset>
    <legend>3. Gift Delivery</legend>
    <div class="notes">
      <h5>Gift Delivery</h5>
      <p>Gifts that remain unopened or unclaimed for 30 days will automatically be invested in one of our projects. If you choose, we can send both you and the recipient multiple email reminders before unclaimed gifts are invested.</p>
    </div>
    <ol>
      <li><label for="gift_notify" class="left"><%= f.check_box :notify_giver %>Let me know this gift is used or not used</label></li>
      <li><label class="left"><%= f.radio_button :send_email, "now", :onchange => "$('gift_send_at').hide();", :checked => "checked" %> Email my gift now</label></li>
      <li><label class="left"><%= f.radio_button :send_email, true, :onchange => "$('gift_send_at').show();" %> Schedule my gift delivery</label></li>
      <li>
        <label class="left">
          <%= f.radio_button :send_email, false, :onchange => "$('gift_send_at').hide();" %> Don't email my gift 
          <div style="margin-left:2em;">(I&rsquo;ll print the ecard and deliver it myself)</div>
        </label>
      </li>
      <li id="gift_send_at"<%= " style=\"display:none;\"" unless @gift.send_email? %>>
        <label class="left" for="gift_send_at_2i">Select a date &amp; time to email your gift ecard</label>
        <div id="gift_send_at_select">
          <%= f.datetime_select :send_at, 
            :order          => [:month, :day, :year, :hour, :minute], 
            :start_year     => Time.now.year, 
            :end_year       => Time.now.year+1, 
            :discard_second => true, 
            :minute_step    => 30,
            :default        => 1.hour.from_now,
            :include_blank  => true %>
          <%= select_tag :time_zone, time_zone_options_for_select(Time.zone.name, TimeZone.us_zones) %>
        </div>
      </li>
    </ol>
  </fieldset>

  <div style="float:right;" class="clearfix"><%= submit_tag 'Add to Cart', :class => 'buttonsubmit', :id => "giftsubmit" %></div>

</div>
<% end %>

<%- content_for :sidebar do -%>
  <%= render "dt/cart/summary" %>
	<%= dt_profile_sidebar %>
<%- end -%>